<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Profile</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        input[type=range] {
            -webkit-appearance: none;
            margin: 8px 0;
            padding: 10px 25px 10px 5px;
            width: 100%;
        }

        input[type=range]:focus {
            outline: none;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 12.8px;
            cursor: pointer;
            animate: 0.2s;
            box-shadow: 0px 0px 0px #000000, 0px 0px 0px #0d0d0d;
            background: palegoldenrod;
            border-radius: 25px;
            border: 0px solid #000101;
        }

        input[type=range]::-webkit-slider-thumb {
            box-shadow: 0px 0px 0px #000000, 0px 0px 0px #0d0d0d;
            border: 0px solid #000000;
            height: 20px;
            width: 39px;
            border-radius: 7px;
            background:sienna;
            cursor: pointer;
            -webkit-appearance: none;
            margin-top: -3.6px;
        }

        input[type=range]:focus::-webkit-slider-runnable-track {
            background: palegoldenrod;
        }

        input[type=range]::-moz-range-track {
            width: 100%;
            height: 12.8px;
            cursor: pointer;
            animate: 0.2s;
            box-shadow: 0px 0px 0px #000000, 0px 0px 0px #0d0d0d;
            background: #ac51b5;
            border-radius: 25px;
            border: 0px solid #000101;
        }

        input[type=range]::-moz-range-thumb {
            box-shadow: 0px 0px 0px #000000, 0px 0px 0px #0d0d0d;
            border: 0px solid #000000;
            height: 20px;
            width: 39px;
            border-radius: 7px;
            background: #65001c;
            cursor: pointer;
        }

        input[type=range]::-ms-track {
            width: 100%;
            height: 12.8px;
            cursor: pointer;
            animate: 0.2s;
            background: transparent;
            border-color: transparent;
            border-width: 39px 0;
            color: transparent;
        }

        input[type=range]::-ms-fill-lower {
            background: #ac51b5;
            border: 0px solid #000101;
            border-radius: 50px;
            box-shadow: 0px 0px 0px #000000, 0px 0px 0px #0d0d0d;
        }

        input[type=range]::-ms-fill-upper {
            background: #ac51b5;
            border: 0px solid #000101;
            border-radius: 50px;
            box-shadow: 0px 0px 0px #000000, 0px 0px 0px #0d0d0d;
        }

        input[type=range]::-ms-thumb {
            box-shadow: 0px 0px 0px #000000, 0px 0px 0px #0d0d0d;
            border: 0px solid #000000;
            height: 20px;
            width: 39px;
            border-radius: 7px;
            background: #65001c;
            cursor: pointer;
        }

        input[type=range]:focus::-ms-fill-lower {
            background: #ac51b5;
        }

        input[type=range]:focus::-ms-fill-upper {
            background: #ac51b5;
        }

        body {
            padding: 30px;
        }
    </style>
</head>

<body>
    <p></p>
    <div class="row">
        <div class="container">
            <div class="col-md-8  col-md-offset-2">
                <div class="card">

                    <div class="row">

                        <div class="col-md-6">
                            <video controls id="v2" width="330" height="250" autoplay="true">
                                <source>
                                </source>
                            </video>
                            <div id="edit" style="display: none;padding: 5px;">
                                <input type="range">
                                <input type="range">
                                <input type="range">
                                <input type="range">
                                <input type="range">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <canvas id="c1" style="border:1px black solid;"></canvas>
                        </div>

                    </div>
                    <div class="card-body text-center">

                        <h4 class="card-title">CHARAFI Oussama</h4>
                        <p class="card-text text-muted">UI/UX Designer</p>
                        <p class="mt-4"><a href="#" class="btn btn-primary" onclick="startCounting(this)"><i
                                    class="glyphicon glyphicon-camera"></i> Capturer</a>

                            <a href="#" class="btn btn-primary" onclick="saveImageProfil()"><i
                                    class="glyphicon glyphicon-save"></i> Save</a>
                            <a href="#" class="btn btn-primary" onclick="showEditDiv()"><i
                                    class="glyphicon glyphicon-edit"></i> Edit</a>
                        </p>
                        <span class="compt"> </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>

        var captured

        const vlib = {
            FPS: 30,
            init() {
                this.canvas = document.querySelector('#c1')
                this.video = document.querySelector('#v2')
                this.ctx = this.canvas.getContext('2d')
                this.w = this.canvas.width = this.video.width
                this.h = this.canvas.height = this.video.height
                this.video.addEventListener('play', _ => this.copy())
                this.startCamera()

            },
            copy() {
                this.ctx.drawImage(this.video, 0, 0, this.w, this.h)
                //this.process()
                if (this.video.ended || this.video.paused)
                    return
                this.captured = setTimeout(_ => this.copy(), 1000 / this.FPS)
            },
            capturer() {

                clearInterval(this.captured)
                this.ctx.drawImage(this.video, 0, 0, this.w, this.h)

                //this.process()

            },
            process() {
                const imageData = this.ctx.getImageData(0, 0, this.w, this.h),
                    data = imageData.data
                for (let i = 0; i < data.length; i += 4) {
                    const r = data[i], g = data[i + 1], b = data[i + 2], a = data[i + 3]
                    //data[i] = data[i + 1] = data[i + 2] = (r + g + b) / 3
                }
                this.ctx.putImageData(imageData, 0, 0)

            },
            async startCamera() {
                this.video2 = document.querySelector('#v2')
                let stream
                try {
                    stream = await navigator.mediaDevices.getUserMedia({ video: true })
                    this.video2.srcObject = stream
                } catch (error) {
                    console.log("something was wrong")
                    videoReplace = document.querySelector('#v2')
                    videoReplace.src = "Big_Buck_Bunny_Trailer.mp4"
                }
            }
        }
        vlib.init()

        function startCounting(link) {

            this.captured = false
            spanChrono = document.querySelector('.compt')

            var cc = 4;

            link.classList.add('btn-default');
            link.classList.remove('btn-primary');
            link.onclick = null;

            var interval = setInterval(function () {
                spanChrono.innerHTML = '  <i class="glyphicon glyphicon-time"></i>  ' + --cc + ' s';

                if (cc == 0) {
                    clearInterval(interval);

                    link.classList.add('btn-primary');
                    link.classList.remove('btn-default');
                    link.onclick = "startCounting(" + link + ")";

                    link.onclick = function () {
                        startCounting(link)
                    }
                    spanChrono.innerHTML = ""
                    vlib.capturer()
                }

            }, 1000);
        }

        function saveImageProfil() {
            let imgData = vlib.canvas.toDataURL("image/png");
            localStorage.setItem("imgData", imgData.replace(/^data:image\/(png|jpg);base64,/, ""));
            window.location = "profile.html";
        }

        function showEditDiv() {
            let state=document.getElementById('edit').style.display;
            if(state=="block")
            document.getElementById('edit').style.display = "none";
            else
            document.getElementById('edit').style.display = "block";

        }

    </script>

</body>

</html>